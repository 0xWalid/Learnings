Exploit a **Serverâ€‘Side Request Forgery (SSRF)** vulnerability by abusing an **open redirection flaw** in the *Next product* feature to access an **internal admin endpoint**, ultimately deleting the user **`carlos`**.

---

## ğŸ§© 1. Initial Testing & Vulnerability Identification

### Feature Tested

- **Next product** functionality on the product page

This feature triggers a **POST request** to the backend to retrieve the next product.

### Parameter Identified

- `stockApi`

This parameter is used by the backend to fetch product-related data and can be influenced by user input.

---

## ğŸ” 2. Identifying the Open Redirect

While analyzing the request, it was observed that the application internally calls the endpoint:

```
/product/nextProduct

```

This endpoint accepts two parameters:

- `currentProductId`
- `path`

### Observation

By modifying the `path` parameter to an external URL, the application **redirected the request without validation**.

Example behavior:

- Setting `path=google.com` caused a redirect to Google
- No filtering or hostname validation was applied

This confirms the presence of an **open redirection vulnerability**.

---

## ğŸ§  3. Why Open Redirects Matter for SSRF

The backend **trusts and follows redirects** when fetching URLs supplied via `stockApi`.

This enables an attack chain where:

1. `stockApi` points to a **legitimate internal endpoint**
2. That endpoint performs a redirect
3. The redirect leads to an **internal system**
4. The backend follows it automatically

This effectively **bypasses SSRF protections**, even if direct internal URLs are restricted.

---

## ğŸ§ª 4. Confirming Internal Access

Testing internal IP addresses showed that internal services were reachable and returned **HTTP 200 responses**, confirming:

- The backend can access internal systems
- SSRF exploitation is possible

---

## ğŸ”— 5. SSRF + Open Redirect Exploitation Chain

### Final Payload Used

```
/product/nextProduct%3fcurrentProductId%3d1%26path%3dhttp%3a//192.168.0.12%3a8080/admin/delete?username=carlos

```

### How This Works

1. `stockApi` is controlled by the attacker
2. It calls `/product/nextProduct`
3. The `path` parameter triggers an **open redirect**
4. The redirect points to an **internal admin endpoint**
5. The backend follows the redirect and executes the request

---

## ğŸ§¨ 6. Privileged Action Execution

The redirected request reached the internal admin interface and executed:

```
/admin/delete?username=carlos

```

### Result

- The user **`carlos`** was deleted successfully
- No authentication was required due to internal trust
- The lab was marked as **solved immediately**

---

## ğŸ“Š 7. Final Result

```
Action performed:Deleteuser
Targetuser: carlos
Accesslevel:Internaladmin
Lab status: Solved

```

---

## ğŸ”® 8. Key Takeaways (Attacker Mindset)

- Open redirects turn **lowâ€‘impact bugs into critical ones**
- SSRF defenses fail if redirect chains are not considered
- Never assume â€œsafeâ€ internal endpoints are harmless
- Always test navigation features for redirect behavior
- SSRF exploitation is about **controlling request flow**, not just URLs

---

## ğŸ§­ 9. Notes for My Future Self

- If SSRF seems blocked, look for redirect gadgets
- Any parameter named `path`, `next`, or `url` is suspicious
- Backend redirect-following equals attacker-controlled routing
- SSRF vulnerabilities are usually **chains, not single bugs**
